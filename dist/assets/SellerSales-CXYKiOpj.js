import{j as a}from"./framer-O_qyKole.js";import{t as j,aj as b,ak as g,ae as f,al as L,aa as w,n as p}from"./index-CwMAiuer.js";import{r as D}from"./react-Bjzu39jn.js";import{S as E}from"./SellerLayout-DwqULL7u.js";import{D as T}from"./ui--o9aqPNp.js";import"./tanstack-cynJ2YVG.js";import"./trpc-DBeWMeKD.js";import"./utils-m6CwOAsu.js";import"./recharts-Decb_PJ4.js";import"./zustand-MWJfmZmr.js";import"./reactHookForm-6EQnDOt0.js";import"./validation-DXqQCM1T.js";function F({operation:{createdAt:t,...e}}){const{mutateAsync:o}=j.shop.seller.report.useMutation(),{proccessDocument:n}=g(),r=()=>{const s=o({...e,cup:parseFloat(e.cup),createdAt:new Date(t)});n(s)};return a.jsx("button",{className:"text-4xl",onClick:r,children:a.jsx(b,{})})}const l=32,x=1,S=8,I=1,u=l-(x+I+S),m="",v="",y="\0";function i(t,e=l){const o=Math.floor((e-t.length)/2);return" ".repeat(o)+t}function C(t,e){const o=[];let n=0;for(;n<t.length;)o.push(t.substring(n,n+e)),n+=e;return o}function h(t,e,o=l){const n=o-(t.length+e.length);return t+" ".repeat(n>0?n:0)+e}function R(t,e,o){const n=C(e,u),r="$"+o.toFixed(2);let s="";s+=t.toString().padStart(x," ")+" "+n[0].padEnd(u," ")+" "+r.padStart(S," ")+`
`;for(let c=1;c<n.length;c++)s+=" ".repeat(x+1)+n[c].padEnd(u," ")+`
`;return s}function A(t){let e="";e+=m+"!"+v+i("TALLER GARCIA. MANZANILLO",l)+m+"!"+y+`
`,e+="-".repeat(l)+`
`,t.client&&(e+=`Cliente: ${t.client}
`),t.address&&(e+=`Dirección: ${t.address}
`),t.contact&&(e+=`Contacto: ${t.contact}
`),(t.client||t.address||t.contact)&&(e+="-".repeat(l)+`
`);let o=0,n=0;return t.sales.forEach(r=>{const s=r.cost;o+=s,n+=s*r.qt,e+=R(r.qt,r.product??"",s*parseFloat(t.cup))+`
`}),e+=h("SUBTOTAL:","$"+(o*parseFloat(t.cup)).toFixed(2))+`
`,e+=h("TOTAL:","$"+(n*parseFloat(t.cup)).toFixed(2))+`
`,e+="-".repeat(l)+`
`,e+=i(new Date().toLocaleString())+`
`,e+=i("ID: "+f(t.id))+`
`,e+=i("¡Gracias por su compra!")+`
`,e+=i("Vuelva pronto")+`
`,e}function N({operation:t}){const e=()=>{const o=A(t),n=new File([o],`factura${f(t.id)}.txt`,{type:"text/plain",lastModified:new Date().getTime()});if(navigator.canShare&&navigator.canShare({files:[n]}))navigator.share({files:[n],title:"Factura",text:"Factura generada para el cliente."}).catch(r=>{console.error("Error al compartir",r)});else{const r=new Blob([n],{type:"text/plain"}),s=window.URL.createObjectURL(r),c=document.createElement("a");c.style.display="none",c.href=s,c.download="factura.txt",document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(s)}};return a.jsx("button",{className:"text-4xl",onClick:e,children:a.jsx(L,{})})}const d=t=>t.reduce((e,o)=>e+o.cost*o.qt,0);function Z(){const{data:t}=j.shop.seller.operations.useQuery(),{box:e,cpus:o}=D.useMemo(()=>{const n=(t||[]).reduce((s,c)=>s+d(c.sales),0),r=(t||[]).reduce((s,c)=>s+parseFloat(c.cup)*d(c.sales),0);return{box:n,cpus:r}},[t]);return a.jsxs(E,{content:"Caja",children:[a.jsxs("div",{className:"bg-green-500 text-white p-5 rounded-lg flex gap-2 items-center justify-between text-[2rem]",children:[a.jsx(w,{}),a.jsx("p",{className:"font-semibold",children:p(e)}),a.jsx("p",{children:p(o,"cup")})]}),a.jsx("div",{className:"flex flex-col gap-4 text-[1.5rem] my-4",children:t==null?void 0:t.map(n=>a.jsxs("div",{children:[a.jsxs("div",{className:"w-full flex items-center justify-between",children:[a.jsxs("p",{children:[" Venta: ",f(n.id,new Date(n.createdAt))]}),a.jsx("p",{children:p(d(n.sales))}),a.jsx("p",{children:p(d(n.sales)*parseFloat(n.cup),"cup")}),a.jsx(F,{operation:n}),a.jsx(N,{operation:n})]}),a.jsx(T,{})]},n.id))})]})}export{Z as default};
