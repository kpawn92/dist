import{j as s}from"./framer-O_qyKole.js";import{t as o,f as w,B as R,X as q,R as _,C as F,n as m}from"./index-CwMAiuer.js";import{u as D}from"./privileges-fdrMHXAC.js";import{r as f}from"./react-Bjzu39jn.js";import{J as j,i as C,G as z,e as P,d as M,p as O,I as U,K as V}from"./ui--o9aqPNp.js";import{c as A}from"./zustand-MWJfmZmr.js";import"./tanstack-cynJ2YVG.js";import"./trpc-DBeWMeKD.js";import"./utils-m6CwOAsu.js";import"./recharts-Decb_PJ4.js";import"./reactHookForm-6EQnDOt0.js";import"./validation-DXqQCM1T.js";const N=A(a=>({reduce:!1,onReduce:()=>a(r=>({reduce:!r.reduce}))})),E=({id:a,qt:r,returns:d})=>{const[l,t]=f.useState(0),[n,c]=f.useState(""),u=o.useUtils(),{mutate:p,isPending:x}=o.shop.returns.useMutation({onSuccess(){j.success("Devolucion registrado correctamente")},onError(e){e.message==="quantity"&&j.error("Ha excedido la cantidad")},onSettled(){u.shop.sales.invalidate()}}),h=d.reduce((e,i)=>e+i.qt,0)>=r||l===0||l>r,g=()=>{p({id:a,observation:n.trim().length>0?n.trim():void 0,qt:r})};return s.jsxs("section",{className:"flex flex-col gap-1",children:[s.jsx(C,{label:"Cantidad a retornar",radius:"sm",color:"danger",type:"number",size:"lg",defaultValue:"0",onValueChange:e=>t(Number(e))}),s.jsx(z,{color:"danger",label:"ObservaciÃ³n",onValueChange:c}),s.jsx(P,{onClick:g,isDisabled:h||x,color:"danger",children:"Aceptar"})]})},W=()=>{const{currentPage:a,setCurrentPage:r}=w(),[d,l]=f.useState(""),{data:t}=o.shop.sales.useQuery({product:d,currentPage:a,sizePage:50}),n=N(e=>e.reduce),c=o.useUtils(),{mutate:u,isPending:p}=o.shop.saleKill.useMutation({onSuccess(){j.success("Registro cancelado correctamente",{position:"top-center"})},onSettled(){c.shop.existence.invalidate(),c.shop.sales.invalidate()}}),x=e=>{u(e)},{isOperator:b}=D(),[h,g]=N(e=>[e.onReduce,e.reduce]);return s.jsxs("section",{children:[s.jsx("div",{className:"fixed top-2 left-2 right-2 z-30",children:s.jsxs("div",{className:"flex flex-col gap-1 shadow-lg",children:[s.jsx("div",{className:"w-full flex gap-2 items-center bg-red-500 text-white rounded-lg p-2",children:s.jsx("div",{className:M(g&&"border-2 rounded-lg"),children:s.jsx(R,{Icon:q,onPress:h,color:"white",type:"button",classNames:{icon:"text-[3rem]"}})})}),s.jsx(C,{label:"Filtrar por descripciÃ³n",color:"danger",onValueChange:l,className:"z-20",radius:"none"})]})}),((t==null?void 0:t.sales)??[]).length>50&&s.jsx(O,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:a,total:(t==null?void 0:t.totalPages)||0,onChange:r}),s.jsx("div",{className:"mt-[150px] mb-[25px]",children:s.jsx(U,{className:"px-s",children:((t==null?void 0:t.sales)??[]).map(e=>{var i,v;return s.jsx(V,{classNames:{subtitle:"text-green-800",title:"text-neutral-600 font-semibold"},"aria-label":`Accordion ${Math.random()*1e3}`,subtitle:"Presione para expandir",title:s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsxs("div",{className:"flex gap-1",children:[s.jsxs("span",{className:"text-green-800",children:["(",e.qt,")"]}),s.jsx("span",{children:(i=e.origin.product)==null?void 0:i.description})]}),s.jsx("span",{children:s.jsx("small",{children:_(e.createdAt)})})]}),children:s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col gap-2",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(F,{onImage:!0,picture:(v=e.origin.product)==null?void 0:v.picture}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"relative text-blue-800 font-bold flex items-center gap-2",children:[s.jsxs("p",{className:"text-[1.8rem]",children:[e.qt,"u"]}),b&&s.jsx(P,{isDisabled:p,onPress:()=>x(e.id),color:"danger",className:"absolute top-0 right-0",children:"Cancelar"})]}),s.jsxs("div",{className:"flex flex-col gap-1 font-bold",children:[s.jsxs("p",{className:"text-[1.2rem] text-green-500",children:["Precio:"," ",m(e.cup&&parseFloat(e.cup)*+e.cost||e.cost,e.cup&&"CUP"||e.origin.output.entry.batch.order.currency)]}),e.cup?s.jsxs("p",{className:"text-[1.2rem] text-blue-800",children:["Total:"," ",m(parseFloat(e.cup)*parseFloat(e.cost)*e.qt,e.cup&&"CUP"||e.origin.output.entry.batch.order.currency)]}):s.jsxs("p",{className:"text-[1.2rem] text-green-800",children:["Total:"," ",m(parseFloat(e.cost)*e.qt,e.origin.output.entry.batch.order.currency)]})]})]})]})}),e.returns.length>0&&s.jsx("div",{children:s.jsxs("p",{className:"text-red-500 font-semibold",children:["Devolciones:"," ",e.returns.reduce((y,S)=>y+S.qt,0)]})}),n&&s.jsx(E,{returns:e.returns,id:e.id,qt:e.qt})]})},e.id)})})})]})};export{W as default};
